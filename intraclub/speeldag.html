<style type="text/css">
  .highlighted {
    background-color: #ebebeb;
  }
  #speeldag-intro {
    display: flex;
    justify-content: space-between;
    color: #666;
    padding-bottom: 25px;
  }
  #speeldag-gemiddelde,
  #speeldag-datum {
    font-size: 20px;
  }
  #speeldag-info {
    font-size: 30px;
  }

  #wedstrijdenSpeeldag {
    border-collapse: collapse;
    width: 100%;
    margin: 0 auto;
    table-layout: fixed;
  }

  #wedstrijdenSpeeldag tr {
    border-bottom: 1px solid #eb0000;
  }
  #wedstrijdenSpeeldag tr:last-child {
    border-bottom: 0px;
  }

  #wedstrijdenSpeeldag td {
    padding: 0.75rem;
    vertical-align: top;
    word-wrap: break-word;
  }

  #wedstrijdenSpeeldag th:first-child,
  #wedstrijdenSpeeldag td:first-child {
    width: 30%;
  }

  #wedstrijdenSpeeldag th:last-child,
  #wedstrijdenSpeeldag td:last-child {
    width: 70%;
  }

  .match-players {
    text-align: center;
    font-weight: bold;
    background-color: #f5f5f5;
  }
  .sets-column {
    /* Removed min-width for mobile compatibility */
    width: 100%;
  }
  .set-details {
    padding: 8px 0;
    border-bottom: 1px solid #ddd;
  }
  .set-details:last-child {
    border-bottom: none;
  }
  .set-header {
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
    font-size: 14px;
  }
  .set-pairing {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 3px 0;
    flex-wrap: wrap;
  }
  .team-left,
  .team-right {
    flex: 1;
    font-size: 16px;
    min-width: 0;
  }
  .team-left {
    text-align: right;
    padding-right: 10px;
  }
  .team-right {
    text-align: left;
    padding-left: 10px;
  }
  .vs {
    font-weight: bold;
    color: #eb0000;
    padding: 0 10px;
    font-size: 14px;
    flex-shrink: 0;
  }
  .score {
    font-weight: bold;
    color: #333;
    text-align: center;
    margin-top: 3px;
  }
  #wedstrijdenTitel {
    display: none;
    justify-content: center;
    color: #666;
    font-size: 32px;
  }
  #wedstrijdenSpeeldagDiv {
    display: none;
    overflow-x: auto;
    width: 100%;
  }

  /* Mobile responsive styles */
  @media (max-width: 768px) {
    #speeldag-intro {
      flex-direction: column;
      gap: 10px;
    }

    #speeldag-gemiddelde,
    #speeldag-datum {
      font-size: 16px;
    }

    #speeldag-info {
      font-size: 24px;
    }

    #wedstrijdenTitel {
      font-size: 24px;
    }

    #wedstrijdenSpeeldag td {
      padding: 0.5rem;
    }

    .team-left,
    .team-right {
      font-size: 14px;
    }

    .vs {
      font-size: 12px;
      padding: 0 5px;
    }

    .set-header {
      font-size: 12px;
    }
  }

  @media (max-width: 480px) {
    #speeldag-informatie {
      margin: 5px 2px;
    }

    .set-pairing {
      flex-direction: column;
      align-items: stretch;
      gap: 5px;
    }

    .team-left,
    .team-right {
      text-align: center;
      padding: 0;
      font-size: 13px;
    }

    .vs {
      text-align: center;
      padding: 5px 0;
    }

    #wedstrijdenSpeeldag td {
      padding: 0.4rem;
    }

    .match-players div {
      font-size: 14px;
      line-height: 1.4;
    }
  }
</style>

<div id="speeldag-informatie" style="margin: 5px 5px">
  <div id="speeldag-intro">
    <div>
      <div id="speeldag-info"></div>
      <div id="speeldag-datum"><i class="far fa-calendar-alt" style="margin-right: 5px"></i></div>
      <div id="speeldag-gemiddelde"></div>
    </div>
  </div>
  <div id="wedstrijdenTitel">Wedstrijden</div>
  <div id="wedstrijdenSpeeldagDiv">
    <table id="wedstrijdenSpeeldag">
      <tbody>
        <tr>
          <th>Spelers</th>
          <th>Sets</th>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script type="text/javascript">
  const urlParams = new URLSearchParams(window.location.search);
  const speeldagId = urlParams.get("speeldagId");
  var request = new XMLHttpRequest();
  request.open("GET", "/intra-app/api/index.php/rounds/" + speeldagId, true);

  request.onload = function () {
    if (this.status >= 200 && this.status < 400) {
      // Success!
      var data = JSON.parse(this.response);
      if (data.id) {
        //setting info
        document.getElementById("speeldag-info").innerText = "Speeldag " + data.number;
        document.getElementById("speeldag-datum").innerHTML += formatDate(data.date);
        document.getElementById("speeldag-gemiddelde").innerText =
          "Gemiddelde afwezigen: " + data.averageAbsent;
        document.getElementById("wedstrijdenTitel").style.display = "flex";
        document.getElementById("wedstrijdenSpeeldagDiv").style.display = "block";
        genereerMatchTabel(document.querySelector("#wedstrijdenSpeeldag"), data.matches);
      } else {
        // We reached our target server, but it returned an error
        document.getElementById("speeldag-informatie").innerText = "Woeps, er ging iets mis!";
      }
    }
  };

  request.onerror = function () {
    // There was a connection error of some sort
    document.getElementById("speeldag-informatie").innerText = "De info kon niet geladen worden";
  };
  request.send();

  function genereerMatchTabel(table, data) {
    for (let element of data) {
      let row = table.insertRow();

      // Get player references
      const player1 = element.firstPlayer;
      const player2 = element.secondPlayer;
      const player3 = element.thirdPlayer;
      const player4 = element.fourthPlayer;

      // Players cell - show all 4 players
      const playersHtml = `
        <div>
          ${bouwSpelerNaam(player1)}<br>
          ${bouwSpelerNaam(player2)}<br>
          ${bouwSpelerNaam(player3)}<br>
          ${bouwSpelerNaam(player4)}
        </div>
      `;
      insertCell(row, playersHtml, "match-players");

      // Sets details cell
      let setsHtml = "";

      // Set 1: P1+P2 vs P3+P4
      setsHtml += `
        <div class="set-details">
          <div class="set-header">Set 1</div>
          <div class="set-pairing">
            <div class="team-left">${bouwSpelerNaam(player1)} & ${bouwSpelerNaam(player2)}</div>
            <div class="vs">vs</div>
            <div class="team-right">${bouwSpelerNaam(player3)} & ${bouwSpelerNaam(player4)}</div>
          </div>
          <div class="score">${bouwSet(element.firstSet)}</div>
        </div>
      `;

      // Set 2: P1+P3 vs P2+P4
      setsHtml += `
        <div class="set-details">
          <div class="set-header">Set 2</div>
          <div class="set-pairing">
            <div class="team-left">${bouwSpelerNaam(player1)} & ${bouwSpelerNaam(player3)}</div>
            <div class="vs">vs</div>
            <div class="team-right">${bouwSpelerNaam(player2)} & ${bouwSpelerNaam(player4)}</div>
          </div>
          <div class="score">${bouwSet(element.secondSet)}</div>
        </div>
      `;

      // Set 3: P1+P4 vs P2+P3
      setsHtml += `
        <div class="set-details">
          <div class="set-header">Set 3</div>
          <div class="set-pairing">
            <div class="team-left">${bouwSpelerNaam(player1)} & ${bouwSpelerNaam(player4)}</div>
            <div class="vs">vs</div>
            <div class="team-right">${bouwSpelerNaam(player2)} & ${bouwSpelerNaam(player3)}</div>
          </div>
          <div class="score">${bouwSet(element.thirdSet)}</div>
        </div>
      `;

      insertCell(row, setsHtml, "sets-column");
    }
  }

  function bouwSpelerNaam(player) {
    return `<a href='/intraclub/speler?spelerId=${player.id}'>${player.firstName} ${player.name}</a>`;
  }

  function bouwVolledigeNaam(player) {
    var spelerLink = "<div";
    spelerLink =
      spelerLink +
      "><a href='/intraclub/speler?spelerId=" +
      player.id +
      "'>" +
      player.firstName +
      " " +
      player.name +
      "</a></div>";
    return spelerLink;
  }
  function bouwSet(set) {
    return set.home + "-" + set.away;
  }
  function insertCell(row, cellText, className) {
    let cell = row.insertCell();
    cell.className = className;
    cell.innerHTML = cellText;
  }
  function formatDate(date) {
    dateObject = new Date(date);
    return (
      dateObject.getDate() + "/" + (dateObject.getMonth() + 1) + "/" + dateObject.getFullYear()
    );
  }
</script>
